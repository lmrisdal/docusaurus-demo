"use strict";(self.webpackChunkdocusaurus_demo=self.webpackChunkdocusaurus_demo||[]).push([[8822],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),h=r,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||i;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5317:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return d}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],s={},l="The ConnXio Api",u={unversionedId:"Adapters/Inbound/api",id:"Adapters/Inbound/api",title:"The ConnXio Api",description:"The ConnXio (CX) Api is reachable through our Api Management (APIM) proxy and gives customers the ability to push messages through the CX pipeline with webhooks as well as use direct transformation endpoints that uses CX's internal logic to map, split or batch messages with code components within their own flows. This page describes the api including information and resources needed to use it.",source:"@site/docs/Adapters/Inbound/api.md",sourceDirName:"Adapters/Inbound",slug:"/Adapters/Inbound/api",permalink:"/docusaurus-demo/Adapters/Inbound/api",draft:!1,editUrl:"https://github.com/lmrisdal/docusaurus-demo/tree/main/docs/Adapters/Inbound/api.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docusaurus-demo/Adapters/Overview"},next:{title:"Azure Storage Outbound Adapter",permalink:"/docusaurus-demo/Adapters/Inbound/azure-storage"}},p={},d=[{value:"Api definition",id:"api-definition",level:2},{value:"Authorization",id:"authorization",level:2},{value:"OAuth",id:"oauth",level:3},{value:"Basic",id:"basic",level:3},{value:"Eventgrid",id:"eventgrid",level:3},{value:"Enable message delivery <code>needs corraltionid picture</code>",id:"enable-message-delivery-needs-corraltionid-picture",level:2},{value:"Correlation Id",id:"correlation-id",level:2},{value:"Endpoints",id:"endpoints",level:2},{value:"Request Example",id:"request-example",level:2},{value:"/api/message",id:"apimessage",level:3},{value:"/api/message/new",id:"apimessagenew",level:3},{value:"Retry",id:"retry",level:2}],c={toc:d};function h(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"the-connxio-api"},"The ConnXio Api"),(0,i.kt)("p",null,"The ConnXio (CX) Api is reachable through our ",(0,i.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/en-us/services/api-management/?&ef_id=CjwKCAjwwsmLBhACEiwANq-tXF5xcD2EmPBq9wtxn2fHg1vExNIvKK1siM9sKzYFiT56qywH12O1QxoCAykQAvD_BwE:G:s&OCID=AID2200230_SEM_CjwKCAjwwsmLBhACEiwANq-tXF5xcD2EmPBq9wtxn2fHg1vExNIvKK1siM9sKzYFiT56qywH12O1QxoCAykQAvD_BwE:G:s&gclid=CjwKCAjwwsmLBhACEiwANq-tXF5xcD2EmPBq9wtxn2fHg1vExNIvKK1siM9sKzYFiT56qywH12O1QxoCAykQAvD_BwE#overview"},"Api Management")," (APIM) proxy and gives customers the ability to push messages through the CX pipeline with webhooks as well as use direct transformation endpoints that uses CX's internal logic to ",(0,i.kt)("a",{parentName:"p",href:"/Transformation/Code-Components"},"map"),", ",(0,i.kt)("a",{parentName:"p",href:"/Transformation/Splitting"},"split")," or ",(0,i.kt)("a",{parentName:"p",href:"/Transformation/Batching"},"batch")," messages with code components within their own flows. This page describes the api including information and resources needed to use it."),(0,i.kt)("h2",{id:"api-definition"},"Api definition"),(0,i.kt)("p",null,"The Api definition can be found in the Api swagger here: ",(0,i.kt)("a",{parentName:"p",href:"https://cmh-prod-api-wa.azurewebsites.net/index.html"},"https://cmh-prod-api-wa.azurewebsites.net/index.html"),". This swagger is hosted by the Api url itself but you will not be able to contact the Api on this url. To be able to contact the api you need to use the APIM endpoint found here: ",(0,i.kt)("inlineCode",{parentName:"p"},"https://cmh-messagehub-apim-prod.azure-api.net"),'. Don\'t mind the "messagehub" name, this is the earlier moniker for ConnXio before we implemented our name-change, in the future we will change the url as well, but the old one will always be operational.'),(0,i.kt)("p",null,"This definition is based on established ",(0,i.kt)("a",{parentName:"p",href:"https://swagger.io/resources/articles/documenting-apis-with-swagger/"},"swagger")," documentation, but we have disabled the test feature for non-communicate employees. If you need to test the Api manually please do so through tools like ",(0,i.kt)("a",{parentName:"p",href:"https://www.postman.com/"},"postman"),"."),(0,i.kt)("h2",{id:"authorization"},"Authorization"),(0,i.kt)("p",null,"To be able to send messages to CX you need to authorize yourself as a CX customer. We support several different credential schemes; Oauth, Basic and EventGrid."),(0,i.kt)("p",null,"All endpoints also require you to supply a ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/api-management/api-management-subscriptions"},"subscription header"),", this basically works as a form of authorization since only valid keys let you access the api. We will show more complete examples later, but a subscription header looks like this: ",(0,i.kt)("inlineCode",{parentName:"p"},"Ocp-Apim-Subscription-Key:007603d399999999xxxx9964y91x7x29"),"."),(0,i.kt)("h3",{id:"oauth"},"OAuth"),(0,i.kt)("p",null,"Oauth is a complex authorization mechanism, read more about it here: ",(0,i.kt)("a",{parentName:"p",href:"https://oauth.net/getting-started/"},"https://oauth.net/getting-started/")),(0,i.kt)("p",null,"To get access to the CX Api you need to contact us through your contact point and order a set of 5 keys:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"client_id"),(0,i.kt)("li",{parentName:"ul"},"client_secret"),(0,i.kt)("li",{parentName:"ul"},"grant_type"),(0,i.kt)("li",{parentName:"ul"},"resource"),(0,i.kt)("li",{parentName:"ul"},"uri")),(0,i.kt)("p",null,"When you have these 5 keys you send a request like described in the curl code below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-curl"},"curl --location --request POST 'https://suppliedbycommunicate.com/oauth2/token' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'client_id={client_id}' \\\n--data-urlencode 'client_secret={client_secret}' \\\n--data-urlencode 'grant_type={grant_type}' \\\n--data-urlencode 'resource={resource}'\n")),(0,i.kt)("p",null,"This returns a token that you add into the Authorization header as ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization:Bearer {token}"),"."),(0,i.kt)("h3",{id:"basic"},"Basic"),(0,i.kt)("p",null,"We do allow our customers to use basic authentication for webhook flows. This is done by simply using the ",(0,i.kt)("a",{parentName:"p",href:"#credentials"},"subscription header")," as authentication. Please contact us for a subscription header that allows this, be aware however that enabling this option is a lot less secure than using ",(0,i.kt)("a",{parentName:"p",href:"#oauth"},"OAuth"),"."),(0,i.kt)("h3",{id:"eventgrid"},"Eventgrid"),(0,i.kt)("p",null,"Eventgrid is used extensively inside Azure and is a framework for building event based architecture on top of Azure components. Read more about eventgrid here ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/event-grid/overview"},"https://docs.microsoft.com/en-us/azure/event-grid/overview"),". We support eventgrid and if you follow the directions provided by Microsoft all you should need to do is point your eventgrid url to the Eventgrid endpoint at ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/EventGrid"),". You need to supply the endpoint with a set of query parameters like so: ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/EventGrid?ConfigCorrelationId={guid}&InterchangeId={guid}"),". The only required parameter is CorrelationId. DocumentType, RecieverId and SenderId are obsolete. FileName supplies the pipeline with a FileName parameter that can be used in ",(0,i.kt)("a",{parentName:"p",href:"/Transformation/Variable-Replacement"},"variable replacement")," and InterchangeId supplies the pipeline with a custom InterchangeId like described ",(0,i.kt)("a",{parentName:"p",href:"/Core-Concepts"},"here"),"."),(0,i.kt)("h2",{id:"enable-message-delivery-needs-corraltionid-picture"},"Enable message delivery ",(0,i.kt)("inlineCode",{parentName:"h2"},"needs corraltionid picture")),(0,i.kt)("p",null,'Even if you have all the authorization and message delivery handled CX will not allow you to communicate with the API unless you have set up an integration and configured it to receive messages through the API. To do this you click the "Inbound Connection" shape and simply select the "Api" option. No other configuration is necessary.'),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cmhpictsa.blob.core.windows.net/pictures/Api%20menu.png?sv=2020-04-08&st=2021-10-27T11%3A49%3A45Z&se=2040-10-28T12%3A49%3A00Z&sr=b&sp=r&sig=OXEdJEImDuRRfHTzsSm%2Bm54TEFILE1itF%2FPRWfUbr2o%3D",alt:"img"})),(0,i.kt)("h2",{id:"correlation-id"},"Correlation Id"),(0,i.kt)("p",null,"All request ",(0,i.kt)("strong",{parentName:"p"},"need to contain a valid CorrelationId")," for CX to be able to process them. This Id can be found on your integrations inside the portal. CorrelationId refers to which integration is to be run on your message, CorrelationId explained in more detail inside the ",(0,i.kt)("a",{parentName:"p",href:"/Core-Concepts"},"Core Concepts page"),"."),(0,i.kt)("h2",{id:"endpoints"},"Endpoints"),(0,i.kt)("p",null,"Cx supplies three endpoint for pure message delivery. All endpoint end up with the same result but allow for different use cases:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"/api/message")," lets you supply your parameters as query parameters. This is excellent for scenarios where you do not have access to the message body or are setting up the request through a third party. The body of the request is treted as the raw message body."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"/api/message/new")," this endpoint lets you supply messages in a ordered JSON format. This lets you supply your message with your chosen encoding in the ",(0,i.kt)("inlineCode",{parentName:"li"},"messageBody")," parameter as base64 encoded bytes. This is more code heavy way of communicating with the Api and lets you have total control over your message body and parameters without having to deal with the peculiars of Urls and query parameters."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"/api/Message/new/batch")," does the exact same thing as ",(0,i.kt)("strong",{parentName:"li"},"2")," but lets you supply an array to the Api. This cuts down on traffic and is easier to handle in large traffic scenarios. As such delivering messages as batches may speed up message processing.")),(0,i.kt)("h2",{id:"request-example"},"Request Example"),(0,i.kt)("p",null,"After ensuring you have the right Url and security credentials a valid request should look something like this:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"DocumentType, RecieverId and SenderId are obsolete.")),(0,i.kt)("h3",{id:"apimessage"},"/api/message"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-curl"},"curl --location --request POST 'https://cmh-messagehub-apim-prod.azure-api.net/api/message?ConfigCorrelationId=xxxx-xxx-xxxx-xxxxx-xxxxxxx' \\\n--header 'Content-Type: application/json' \\\n--header 'Ocp-Apim-Subscription-Key: xxxxxxxxxxxxxxxxxxxxx' \\\n--header 'Authorization: Bearer {token}' \\\n--data-raw '{\n \"Prop\": \"Superdupertest\"\n}'\n")),(0,i.kt)("h3",{id:"apimessagenew"},"/api/message/new"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-curl"},'curl --location --request POST \'https://cmh-messagehub-apim-prod.azure-api.net/api/message/new\' \\\n--header \'Content-Type: application/json\' \\\n--header \'Ocp-Apim-Subscription-Key: 631373d321784590baff7464d91a7c69\' \\\n--header \'Authorization: Bearer {token}\' \\\n--data-raw \'{\n  "messageEncoding": "utf-8",\n  "configCorrelationId": "xxxx-xxxx-xxx-xxx-xxx",\n  "interchangeId": "x1xx-1xxx-xxx-111-x1x",\n  "messageBody": "ewoJIlByb3AiOiAiU3VwZXJkdXBlcnRlc3QiLAoJIlByb3AiOiAiU3VwZXJkdXBlcnRlc3QiLAoJIlByb3AiOiAiU3VwZXJkdXBlcnRlc3QiCn0=",\n  "fileName": "myfile"\n}\'\n')),(0,i.kt)("h2",{id:"retry"},"Retry"),(0,i.kt)("p",null,"Be aware that when using our Api you are required to handle all retry on the client side. Our regular SLA is in effect at all times but hiccups can happen within all network infrastructure and should be assessed and handled as needed."))}h.isMDXComponent=!0}}]);