"use strict";(self.webpackChunkdocusaurus_demo=self.webpackChunkdocusaurus_demo||[]).push([[2162],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return u}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),u=a,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1314:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return m}});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],s={title:"Code Components"},l="Code components",p={unversionedId:"Transformation/code-components",id:"Transformation/code-components",title:"Code Components",description:"ConnXio (CX) uses C# code to transform data at multiple points through the CX pipeline. This page describes how to create a code component for transformation, where you can use it and what possibilities open up to you by using it. See splitting and batching for information on code components within those processes.",source:"@site/docs/Transformation/code-components.md",sourceDirName:"Transformation",slug:"/Transformation/code-components",permalink:"/Transformation/code-components",draft:!1,editUrl:"https://github.com/lmrisdal/docusaurus-demo/tree/main/docs/Transformation/code-components.md",tags:[],version:"current",frontMatter:{title:"Code Components"},sidebar:"tutorialSidebar",previous:{title:"Batching",permalink:"/Transformation/batching"},next:{title:"Data Collection",permalink:"/Transformation/data-collection"}},c={},m=[{value:"What is a code component?",id:"what-is-a-code-component",level:2},{value:"Creating a component",id:"creating-a-component",level:2},{value:"Termination",id:"termination",level:3},{value:"Uploading your component",id:"uploading-your-component",level:2},{value:"Using the component",id:"using-the-component",level:2},{value:"Caching",id:"caching",level:2}],d={toc:m};function u(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"code-components"},"Code components"),(0,r.kt)("p",null,"ConnXio (CX) uses C# code to transform data at multiple points through the CX pipeline. This page describes how to create a ",(0,r.kt)("em",{parentName:"p"},"code component")," for transformation, where you can use it and what possibilities open up to you by using it. See ",(0,r.kt)("a",{parentName:"p",href:"/Transformation/Splitting"},"splitting")," and ",(0,r.kt)("a",{parentName:"p",href:"/Transformation/Batching"},"batching")," for information on code components within those processes."),(0,r.kt)("h2",{id:"what-is-a-code-component"},"What is a code component?"),(0,r.kt)("p",null,"A code component is essentially C# code compiled into a dll file. We use reflection to run these files in a sandbox where we supply the message content and other variables and use the output for further processing."),(0,r.kt)("h2",{id:"creating-a-component"},"Creating a component"),(0,r.kt)("p",null,"The easiest way to create you own code component is to start by opening Visual Studio and creating a new ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/visualstudio/get-started/csharp/tutorial-console?view=vs-2019"},"console project"),". Use .net core 3.1 or .net standard 2.1 for new components. We do have some backwards compatibility, and if you cant get your code to work feel free to contact us."),(0,r.kt)("p",null,"After you create the project and open it you need to create a file called ",(0,r.kt)("strong",{parentName:"p"},"Initialize")," and paste this code inside:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'/// <summary>\n/// The method name must be Map but you can add as many files and other methods that you want, and call them inside Map. But you must use this signature and return a string.\n/// </summary>\n/// <param name="message">The message content as it is currently. This changes as the engine runs trough different transformations</param>\n/// <param name="dataCollection">The data collection properties you have collected earlier in the transformation pipeline</param>\n/// <param name="userDefinedProperties">The user defined properties that are transferred with the message metadata. Put variables here to access them later outside message content.</param>\n/// <returns>A string of the transformed message</returns>\npublic string Map(string message, Dictionary<string, string> dataCollection, Dictionary<string, string> userDefinedProperties)\n{\n    //Add error handling as necessary, this will give better error messages in the logs\n    if (message == null)\n        throw new ArgumentException("Message field is null");\n\n    //You can use newtonsoft and other basic nuget packages. Contact the CX team if you need a non supported package.\n    dynamic obj = JsonConvert.DeserializeObject(message);\n    obj.Prop = "Done";\n    \n    //Add data to user properties if needed\n    userDefinedProperties("INeedThisLater", obj.prop);\n\n    //Use collected data as needed\n    obj.Prop2 = dataCollection["MyCollectedData"];\n\n    //Return string representation of the message to propagate through pipeline\n    return JsonConvert.SerializeObject(obj);\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"NOTE: JsonConvert requires Newtonsoft version 12.0.3 or older."))),(0,r.kt)("p",null,"The code above adds examples of the most basic functionality provided by code components and is an boiler plate for most transformations. We would recommend adding a method to yor project to run the Map method with sample input. This can be done either in the Program.cs of a console project or through a Unit test or some other means, this is all subjective preference. An example of a the unit test method is featured below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public class CodeComponentTest\n{\n    public Initialize Mapper { get; set; }\n\n    [SetUp]\n    public void Setup()\n    {\n        Mapper = new Initialize();\n    }\n\n    [Test]\n    public void Test_Map_Invoice()\n    {\n        string testDataColContentAsString = GetTestDataColContentString();\n        string testContentAsString = GetTestContentString();\n\n        Dictionary<string, string> dataCol = new Dictionary<string, string>();\n        dataCol.Add("invoice", testDataColContentAsString);\n\n        var mappedContent = Mapper.Map(testContentAsString, dataCol, new Dictionary<string, string>());\n    }\n\n    private string GetTestDataColContentString()\n    => File.ReadAllText(@"TestFiles/Invoice/Test_Invoice_Multiline.txt");\n\n    private string GetTestContentString()\n    => File.ReadAllText(@"TestFiles/Invoice/Partitioned_Id.txt");\n}\n')),(0,r.kt)("p",null,"After writing and testing your component you need to create the dll file itself. The easiest way to do this is simply by building you code (which it should have done automatically by now). You will find you dll file inside a folder looking something like this: ",(0,r.kt)("inlineCode",{parentName:"p"},"...\\MyProject\\bin\\Debug\\netcoreapp3.1\\bin\\MyProject.dll"),"."),(0,r.kt)("h3",{id:"termination"},"Termination"),(0,r.kt)("p",null,"You can terminate a message by throwing a 'NotImplementedException' from you transformation code component. This does not work on splitting and batching variants. The exception type is fairly mismatched as far as termination of messages but it's one of the only exception types that exists in the base C# system, package that is never thrown by the code itself. This is the reason we chose to use this exact exception. We might amend this with our own exceptions in the future."),(0,r.kt)("p",null,"You can supply the termination error message with a set of code words to influence the behavior of the termination process. The pipeline is always terminated but the code word controls the logging associated with it. You supply these code words in the following way:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'//The code word before the pipe (|) is used to select the action while the text after the pipe is used as the log event message sent via the [logging events functionality](/Logging).\nthrow new NotImplementedException("Warning|Pipeline terminated with warning");\n')),(0,r.kt)("p",null,"We support the following options on termination:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Code word"),(0,r.kt)("th",{parentName:"tr",align:null},"Action"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Success"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Warning"),(0,r.kt)("td",{parentName:"tr",align:null},"The termination is logged as a warning with the minimum log level.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Error"),(0,r.kt)("td",{parentName:"tr",align:null},"The termination is logged as an error with the none log level.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Loglevel:None"),(0,r.kt)("td",{parentName:"tr",align:null},"The termination is logged with the terminated status but with the none log level instead of the default minimum level.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Loglevel:Never"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Default behavior")),(0,r.kt)("td",{parentName:"tr",align:null},'The termination is logged with the terminated status on the minimum log level with the message: "Transaction terminated by code map"')))),(0,r.kt)("h2",{id:"uploading-your-component"},"Uploading your component"),(0,r.kt)("p",null,"CX supports both internal and external component upload locations. If you want to use external upload management the only real requirement is that the raw component dll is available on a REST GET request at the endpoint you specify in your integration configuration like shown below:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cmhpictsa.blob.core.windows.net/pictures/Code%20Mapping%20Self%20hosted.PNG?sv=2020-04-08&st=2021-10-20T11%3A20%3A16Z&se=2040-10-21T11%3A20%3A00Z&sr=b&sp=r&sig=iwI0j%2Fyh8iCN48%2BrktJaxgGrqXqA9DmOl5sT2HHCyMU%3D",alt:"img"})),(0,r.kt)("p",null,"Internal upload management can be done in the ",(0,r.kt)("em",{parentName:"p"},"Code Components")," view inside the ConnXio Portal. Choose ",(0,r.kt)("em",{parentName:"p"},"Upload new component")," and fill in the necessary fields like so:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cmhpictsa.blob.core.windows.net/pictures/Internal%20code%20mapping.PNG?sv=2020-04-08&st=2021-10-20T11%3A25%3A22Z&se=2040-10-21T11%3A25%3A00Z&sr=b&sp=r&sig=xPBSb9XGhTGJvEuCQBVEttFnvsXigrtdyKzwmbgFWzk%3D",alt:"img"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Name:")," The name of the map that you can reference in the component list.\\\n",(0,r.kt)("strong",{parentName:"p"},"Type:")," The type of map. Read more about types ","[here]",".\\\n",(0,r.kt)("strong",{parentName:"p"},"Description:")," A description of your map.\\\n",(0,r.kt)("strong",{parentName:"p"},"Version:")," The version of the map. You can deprecate and manage maps by version in the component view."),(0,r.kt)("h2",{id:"using-the-component"},"Using the component"),(0,r.kt)("p",null,"To use the component you have created you enter the ",(0,r.kt)("a",{parentName:"p",href:"/Integrations/creating-integrations"},"Integrations")," menu and either select or create your integration. Use the ",(0,r.kt)("a",{parentName:"p",href:"/Transformation/code-components#using-the-component"},"transformation")," menu to add a code component shape as seen below."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cmhpictsa.blob.core.windows.net/pictures/Code%20mapping%20add%20tranformation.png?sv=2020-04-08&st=2021-10-21T11%3A01%3A19Z&se=2040-10-22T11%3A01%3A00Z&sr=b&sp=r&sig=7sKZFsU0p1B4EJDZowq6aAL8GDtkm2tkpbw94JjzTlo%3D",alt:"img"})),(0,r.kt)("p",null,"After you add the shape you need to select your component in the code component window. If you use internal upload the input will look something like shown below:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cmhpictsa.blob.core.windows.net/pictures/Code%20Mapping%20select%20mapping.PNG?sv=2020-04-08&st=2021-10-21T11%3A05%3A02Z&se=2040-10-22T11%3A05%3A00Z&sr=b&sp=r&sig=8ViYt9AB%2B5blz8GJvbT4rsuHNXfZsWN%2Fj8IxhjdEteM%3D",alt:"img"})),(0,r.kt)("p",null,"If you use external upload you select the SasUsi option and paste your URI in the input field there."),(0,r.kt)("h2",{id:"caching"},"Caching"),(0,r.kt)("p",null,"All components are cached for 30 seconds when loaded into the service. Keep this in mind when doing rapid changes to component code."))}u.isMDXComponent=!0}}]);